<html>
<head>
<title>ILLiad - Book Request</title>
<link rel="stylesheet" type="text/css" href="css/main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js"></script>
<!--[if lte IE 6]>
<link rel="stylesheet" type="text/css" href="css/ie6_or_less.css" />
<![endif]-->
</head>
<body id="type-b">
<div id="wrap">
    <#INCLUDE filename="include_header_request.html">
    <div id="content-wrap">
		<#INCLUDE filename="include_menu.html">
        <div id="content" style="display: none;">
            <form id="LoanRequestForm" action="illiad.dll" method="post" name="LoanRequest" class="f-wrap-request">
                <input type="hidden" name="ILLiadForm" value="LoanRequest">
                <input type="hidden" name="Username" value="<#PARAM name="Username">">
								<input type="hidden" name="ItemInfo1" value="Book">
                <input type="hidden" name="SessionID" value="<#PARAM name="SessionID">">
                <div class="req"><b>*</b> Indicates required field</div>
                <fieldset>
                	<h3 id="pageHeader">Loan Request (Including Multimedia)</h3>
					<#STATUS>
								
                	<h2>Describe the item you want</h2>
                	<label for="LoanAuthor">
						<span class="field">
                			<span class="req">*</span>
							<span class="<#ERROR name="ERRORLoanAuthor">"><b>Author/Editors</b></span>
						</span>
                		<input id="LoanAuthor" name="LoanAuthor" type="text" size="40" class="f-name"  value="<#PARAM name="LoanAuthor">"><br />
               	</label>
                	
					<label for="LoanTitle">
                		<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORLoanTitle">"><b>Title</b></span><br />
                			<span class="note">We do not process requests for textbooks.</span>
						</span>
                		<textarea id="LoanTitle" name="LoanTitle" rows="2" cols="40" class="f-name" ><#PARAM name="LoanTitle"></textarea><br />
               	</label>
                	
					<label for="LoanPublisher">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanPublisher">"><b>Publisher</b></span>
						</span>
                		<input id="LoanPublisher" name="LoanPublisher" type="text" size="40" class="f-name"  value="<#PARAM name="LoanPublisher">"><br />
               	</label>
					
                	<label for="LoanPlace">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanPlace">"><b>Place of Publication</b></span>
						</span>
                		<input id="LoanPlace" name="LoanPlace" type="text" size="40" class="f-name"  value="<#PARAM name="LoanPlace">"><br />
               	</label>
					
                	<label for="LoanDate">
                		<span class="field">
							<span class="<#ERROR name="ERRORLoanDate">"><b>Date of Publication</b></span>
						</span>
                		<input id="LoanDate" name="LoanDate" type="text" size="40" class="f-name"  value="<#PARAM name="LoanDate">"><br />
               	</label>
                
					<label for="LoanEdition">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanEdition">"><b>Edition</b></span>
						</span>
                		<input id="LoanEdition" name="LoanEdition" type="text" size="40" class="f-name"  value="<#PARAM name="LoanEdition">"><br />
               	</label>
					
                	<label for="ISSN">
					 	<span class="field">
                			<span class="<#ERROR name="ERRORISSN">"><b>ISBN (International Standard Book Number)</b></span><br />
                		<span class="note">If given will speed request processing</span>
						</span>
                		<input id="ISSN" name="ISSN" type="text" size="20" class="f-name"  value="<#PARAM name="ISSN">"><br />
               	</label>
					
                	<label for="CallNumber">					
						<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORCallNumber">"><b>Call Number</b></span>
						</span>
                		<input id="CallNumber" name="CallNumber" type="text" size="20" class="f-name"  value="<#PARAM name="CallNumber">"><br />
               	</label>
					
                	<label for="ESPNumber">
						<span class="field">
                			<span class="<#ERROR name="ERRORESPNumber">"><b>OCLC or Docline UI Number</b></span>
						</span>
                		<input id="ESPNumber" name="ESPNumber" type="text" size="20" class="f-name"  value="<#PARAM name="ESPNumber">"><br />
               	</label>
					
                	<label for="NotWantedAfter">
						<span class="field">
                			<span class="req">*</span><span class="<#ERROR name="ERRORNotWantedAfter">"><b>Not Wanted After Date</b></span><br />
							<span class="note">(MM/DD/YYYY)</span>
						</span>
                		<input id="NotWantedAfter" name="NotWantedAfter" type="text" size="40" class="f-name"  value="<#PARAM name="NotWantedAfter">"><br />
               	</label>
					
                	<label for="AcceptNonEnglish">
						<span class="field">
                			<span class="req">*</span>			<span class="<#ERROR name="ERRORAcceptNonEnglish">"><b>Will you accept the item in a language other than English?</b></span><br />
                			<span class="note">If yes, specify acceptable languages in the notes field.</span>
						</span>
                		<select id="AcceptNonEnglish" name="AcceptNonEnglish" size="1" class="f-name" >
                    		<option selected><#PARAM name="AcceptNonEnglish"></option>
                    		<option>No</option>
                    		<option>Yes</option>
                		</select>
						<br />
               	</label>
					
                	<label for="AcceptAlternateEdition">
						<span class="field">
                			<span class="req">*</span>			<span class="<#ERROR name="ERRORAcceptAlternateEdition">"><b>Will you accept an alternate edition of this item?</b></span>
						</span>
                		<select id="AcceptAlternateEdition" name="AcceptAlternateEdition" size="1" class="f-name" >
                    		<option selected><#PARAM name="AcceptAlternateEdition"></option>
                    		<option>No</option>
                    		<option>Yes</option>
                		</select>
                		<br />
               	</label>
								
									
                	<label for="ItemInfo2" style="display: none;">
										<span class="field">
											<span class="req">*</span>
											<b><span id="itemInfo2Text" class="valid">Are you a faculty member or graduate student?</span></b>
											<br>
											<!--<span id="itemInfo2Note" class="note">You must be a faculty member or graduate student to use this service.</span>-->
										</span>
					
										<select id="ItemInfo2" name="ItemInfo2">
											<option selected></option>
											<option>Faculty</option>
											<option>Graduate student</option>
											<option>Neither</option>
										</select>
										<br>
									</label>
									
									<label for="ItemInfo5" style="display: none;">
											<span class="field">
												<b><span id="itemInfo5Text" class="valid">Is this an Annex item?</span></b>
												<br>
												<!--<span id="itemInfo2Note" class="note">You must be a faculty member or graduate student to use this service.</span>-->
											</span>
					
											<select id="ItemInfo5" name="ItemInfo5">
												<option selected></option>
												<option>Yes</option>
												<option>No</option>
											</select>
											<br>
									</label>
									
									<label for="ItemInfo3" style="display: none;">
										<span class="field"><b>Campus mailbox</b><br>
											
											<span class="note">Faculty may choose to have an item delivered to their campus mailbox.</span>
										</span>
										<textarea id="ItemInfo3" type="text" name="ItemInfo3" rows="2"></textarea>
									<br>
									</label>
									
									<label for="ItemInfo4" style="display: none;">
										<span class="field">
											<b><span id="ItemInfo4Text" class="valid">Pickup library</span></b>
											<br>
											<!--<span id="ItemInfo4Note" class="note">For document delivery, faculty or graduate students may choose to pick up their item at a library other than Gorgas.</span>-->
										</span>
					
										<select id="ItemInfo4" name="ItemInfo4">
											<option selected></option>
											<option>Gorgas</option>
											<option>Rodgers</option>
											<option>Bruno</option>
											<option>McLure</option>
										</select>
										<br>
										

									</label>
									<!--
										<label for="Address">
											<span class="field">
														<span class="<#ERROR name="ERRORAddress">"><b>Web Services Test -- ignore!</b></span>
											</span>
											<input id="Address" name="Address" type="text" size="40" class="f-name"  value="<#PARAM name="Address">"><br />
										</label>
										<label for="Site">
												<span class="field">
														<b><span class="<#ERROR name="ERRORSite">">Site (temporary Web Serv test)</span></b>
														<br>
												</span>
										   <select id="Site" name="Site" size="1" class="f-name" >
													<#OPTION name="custom" groupname="Site" defaultValue="Gorgas" />
											</select>
										</label>-->
									
									
									
									
                	<label for="Notes">
						<span class="field">
                			<span class="<#ERROR name="ERRORNotes">"><b>Notes</b></span><br />
                			<span class="note">Put any information here that may help us find the item, as well as any other pertinent information.</span>
						</span>
                		<textarea id="Notes" name="Notes" rows="2" cols="40" class="f-name" ><#PARAM name="Notes"></textarea><br />
               	</label>
								
								
									</label>
									
					
                	<#INCLUDE filename="include_request_cited.html">                
                    <#INCLUDE filename="include_request_buttons.html">
                </fieldset>
            </form>

            <#INCLUDE filename="include_footer.html">
        </div>
    </div>
</div>


</body>
<script>
		console.log("VANILLA JS");
		var content = document.querySelector('#content'); 
		content.setAttribute('display', 'block');
</script>
<script>
$(document).ready(function(){

					requiredFields = ['LoanTitle', 'LoanAuthor', 'NotWantedAfter', 'AcceptAlternateEdition', 'AcceptNonEnglish']; 

					var parameters = decodeURIComponent(document.location.search)

					 if ((parameters.indexOf('docdelivery=true') != -1)){
							//$('label[for="Notes"]').css('display', 'none');
							
							$('#requestCited').css('display', 'none');
							
							//Add required fields
							requiredFields.push('ItemInfo2');
							requiredFields.push('CallNumber');
							
							$('input[name="ItemInfo1"]').attr('value', 'DocDeliveryPublic');
							
							//If both catalog and document delivery parameters are present, add doc delivery to form for automatic routing
							if ((parameters.indexOf('catalog=true') != -1)){
								$('input[name="ItemInfo1"]').attr('value', 'DocDelivery');
							}
							
							//Hide buttons that no longer work
							//$('input[name="ResetButton"]').css('display', 'none');
							$('input[value^="Cancel"]').css('display', 'none');
							
							
							$('#pageHeader').html("Document Delivery - Loan (UA Libraries Collection)");
							$('#pageHeader').after('<p id="pageIntroduction">Use this form to request document delivery for items you want to check out from University Libraries (this includes Annex requests). Faculty can choose to have items delivered to their campus mailbox via intracampus mail. You may be able to select a pickup library for an item depending on your status and the type of the request.</p>');
							$('label[for="ItemInfo2"]').css('display', 'block');
							$('label[for="ItemInfo5"]').css('display', 'block');
							//$('label[for="ItemInfo4"]').css('display', 'block');
						
							$('#ItemInfo2').change(function(){
							
							  var annexValue = $('#ItemInfo5').val();
								
								if ($(this).val() == 'Faculty'){
										$('label[for="ItemInfo4"]').fadeIn(150);
										console.log("annex value is " + annexValue); 
										//if (annexValue != 'Yes'){
											$('label[for="ItemInfo3"]').fadeIn(150);
										//}
								}		
								else if ($(this).val() == 'Graduate student'){
										$('label[for="ItemInfo3"]').fadeOut(150);
										$('label[for="ItemInfo4"]').fadeIn(150);
								}
								else if ($(this).val() == 'Neither'){
										$('label[for="ItemInfo3"]').fadeOut(150);
										if (annexValue != 'Yes'){
											$('label[for="ItemInfo4"]').fadeOut(150);
										}
								}
								else {
										$('label[for="ItemInfo3"]').fadeOut(150);
										if (annexValue != 'Yes'){
											$('label[for="ItemInfo4"]').fadeOut(150);
										}
								}
								
								if (annexValue == 'Yes'){
									//$('#ItemInfo4Note').text("For Annex requests, any user can specify a pickup library.");
								}
								else{
									 //$('#ItemInfo4Note').text("For document delivery, faculty or graduate students may choose to pick up their item at a library other than Gorgas.");
								}
							});
							
							$('#ItemInfo3').change(function(){
									console.log("CHANGE FIRES!");
								 if ($('#ItemInfo3').val() != ''){
										if ($('#pickupNote').length > 0){
											$('#pickupNote').css('display', 'block');
										}
										else {							
											$('#ItemInfo4Note').before('<span id="pickupNote" class="note" style="display: block"><strong>Since you specified delivery to your campus mailbox, pickup library can be left blank. </strong></span>');
										}
									}
								 else{
										console.log("HITS ELSE!");
										if ($('#pickupNote').length > 0){
											$('#pickupNote').css('display', 'none');
										}
								 }
							});
							
							$('#ItemInfo5').change(function(){
							  var facGradValue = $('#ItemInfo2').val(); 
								if ($(this).val() == 'Yes'){
									//$('#ItemInfo4Note').text("For Annex requests, any user can specify a pickup library.");
		
									$('label[for="ItemInfo4"]').fadeIn(150);
									if (facGradValue == 'Faculty'){
										$('label[for="ItemInfo3"]').fadeIn(150);
									}
								}
								else if (($(this).val() == 'No') || ($(this).val() == '')){
								  //$('#ItemInfo4Note').text("For document delivery, faculty or graduate students may choose to pick up their item at a library other than Gorgas.");
								
									console.log(facGradValue);
									/*
									if ((facGradValue != 'Faculty') && (facGradValue != 'Graduate student')){
										$('label[for="ItemInfo4"').fadeOut(150);
									}
									else{
										$('label[for="ItemInfo4"').fadeOut(150);
									}*/
									
									if (facGradValue == 'Faculty'){
										$('label[for="ItemInfo3"]').fadeIn(150);
										$('label[for="ItemInfo4"]').fadeIn(150);
									}
									else if (facGradValue == 'Graduate student'){
										$('label[for="ItemInfo4"]').fadeIn(150);
									}
									else{
										$('label[for="ItemInfo3"]').fadeOut(150);
										$('label[for="ItemInfo4"]').fadeOut(150);
									}
								}
							});
	
							

						
					 }

					 else {
							$('label[for="CallNumber"] span.req').css('display', 'none');
					 }
					 /*
					 if ((parameters.indexOf('intracampus=true') != -1)){
					  console.log("INTRACAMPUS IS TRUE!");
					 	$('label[for="ItemInfo3"]').css('display', 'block');	
						$('label[for="ESPNumber"]').css('display', 'none');	
						$('#pageHeader').html("Intracampus Delivery");	
						$('#pageIntroduction').html('');
						$('#deliveryInformation').css('display', 'block');
						$('#pageIntroduction').html(' <span style="text-decoration: underline">Only faculty may use this service.</span>  Use this form to request delivery of an interlibrary loan item to your campus mailbox.');	
						$('#itemInfo2Text').html('Are you a faculty member?');	
						$('#itemInfo2Note').html('Only faculty may use this service.');	
						$('#intracampusLink').css('display', 'none');
					 }
					 */
					 
					 	$('#LoanRequestForm').submit(function(event){
	
								 var missingFields = []; 
								 
								 for (i = 0; i < requiredFields.length; i++){
										currentField = requiredFields[i];
										currentContent = $('#' + currentField).val();
										
										//console.log("CURRENT FIELD IS");
										//console.log(currentField);
										
										//console.log("CURRENT CONTENT IS");
										//console.log(currentContent);
										
										if (currentField == 'ItemInfo2'){
											if ((currentContent == '') || (currentContent == 'No')){
												missingFields.push(currentField);
												$('label[for="' + currentField + '"] span.valid').addClass('validationError').removeClass('valid');
											}
										}
										else if (currentContent == ''){											
											console.log("FORM UNFILLED!");
											missingFields.push(currentField);
											$('label[for="' + currentField + '"] span.valid').addClass('validationError').removeClass('valid');
										}	
										else {
											$('label[for="' + currentField + '"] span.validationError').addClass('valid').removeClass('validationError');
										}
								 }

								if (missingFields.length > 0){
									 for (i = 0; i < missingFields.length; i++){
											missingField = missingFields[i];
											//var errorHTML = '<p style="color: red;">This field is required!</p>';
											$('label[for="' + missingField + '"] span.valid').addClass('validationError').removeClass('valid');
										}
									 topErrorMessage = '<p style="color: red;">Required fields are missing.</p>';
									 
									 console.log("MISSING FIELDS ARRAY");
									 console.log(missingFields);
									 /*
									 if (missingFields.indexOf('ItemInfo2') != -1){
									 
											//TODO: Remove if statement if redundant (as it currently is)
											if (missingFields.length == 1){
												topErrorMessage += '<p style="color: red;">You must be a faculty member or graduate student to use this service.</p>';  
											}
											else {
												topErrorMessage += '<p style="color: red;">You must be a faculty member or graduate student to use this service.</p>' 
											}
									 }*/
									 
									 topErrorMessage += "</div>";
									 
									 console.log("TOP ERROR MESSAGE IS");
									 console.log(topErrorMessage);
									 if ($('#TopErrorMessage').length == 0){
										 topErrorMessage = '<div id="TopErrorMessage">' + topErrorMessage + '</div>';
										 $('#pageHeader').after(topErrorMessage);
									 }
									 else {
									  $('#TopErrorMessage').html('');
										$('#TopErrorMessage').html(topErrorMessage);
									 }
									 
									 return false;						 
								 }					
						});
					 
					
					 $('#content').css('display', 'block');

});
</script>
<script>
console.log("VANILLA JS");
var content = document.querySelector('#content'); 
content.setAttribute('display', 'block');
</script>
</html>
