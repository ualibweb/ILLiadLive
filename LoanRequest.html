<html>
<head>
<title>ILLiad - Book Request</title>
<link rel="stylesheet" type="text/css" href="css/main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js"></script>
<!--[if lte IE 6]>
<link rel="stylesheet" type="text/css" href="css/ie6_or_less.css" />
<![endif]-->
</head>
<body id="type-b">
<div id="wrap">
    <#INCLUDE filename="include_header_request.html">
    <div id="content-wrap">
		<#INCLUDE filename="include_menu.html">
        <div id="content" style="display: none;">
            <form id="LoanRequestForm" action="illiad.dll" method="post" name="LoanRequest" class="f-wrap-request">
                <input type="hidden" name="ILLiadForm" value="LoanRequest">
                <input type="hidden" name="Username" value="<#PARAM name="Username">">
								<input type="hidden" name="ItemInfo1" value="Book">
                <input type="hidden" name="SessionID" value="<#PARAM name="SessionID">">
								<input type="hidden" name="DocumentType" value="Book">
                <div class="req"><b>*</b> Indicates required field</div>
                <fieldset>
                	<h3 id="pageHeader">Loan Request (Including Multimedia)</h3>
					<#STATUS>
								
                	<h2>Describe the item you want</h2>
									
									<label style="display: none;" for="itemInfo2">
										<span class="field">
										<span>
											<b>Serial loan request</b><br>
											<span class="note">Indicate if you would like to make a loan request for a serial. </span>
										</span>
										</span>
                		<select id="itemInfo2" name="itemInfo2">
											<option>Yes</option>
											<option selected>No</option>
										</select><br />
               	 </label>
									
									
                	<label for="LoanAuthor">
						<span class="field">
                			<span class="req">*</span>
							<span class="<#ERROR name="ERRORLoanAuthor">"><b>Author/Editors</b></span>
						</span>
                		<input id="LoanAuthor" name="LoanAuthor" type="text" size="40" class="f-name"  value="<#PARAM name="LoanAuthor">"><br />
               	</label>
                	
					<label for="LoanTitle">
                		<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORLoanTitle">"><b>Title</b></span><br />
                			<span class="note">We do not process requests for textbooks.</span>
						</span>
                		<textarea id="LoanTitle" name="LoanTitle" rows="2" cols="40" class="f-name" ><#PARAM name="LoanTitle"></textarea><br />
               	</label>
                	
					<label for="LoanPublisher">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanPublisher">"><b>Publisher</b></span>
						</span>
                		<input id="LoanPublisher" name="LoanPublisher" type="text" size="40" class="f-name"  value="<#PARAM name="LoanPublisher">"><br />
               	</label>
					
                	<label for="LoanPlace">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanPlace">"><b>Place of Publication</b></span>
						</span>
                		<input id="LoanPlace" name="LoanPlace" type="text" size="40" class="f-name"  value="<#PARAM name="LoanPlace">"><br />
               	</label>
					
                	<label for="LoanDate">
                		<span class="field">
							<span class="<#ERROR name="ERRORLoanDate">"><b>Date of Publication</b></span>
						</span>
                		<input id="LoanDate" name="LoanDate" type="text" size="40" class="f-name"  value="<#PARAM name="LoanDate">"><br />
               	</label>
                
					<label for="LoanEdition">
						<span class="field">
                			<span class="<#ERROR name="ERRORLoanEdition">"><b>Edition</b></span>
						</span>
                		<input id="LoanEdition" name="LoanEdition" type="text" size="40" class="f-name"  value="<#PARAM name="LoanEdition">"><br />
               	</label>
								
								<!--<label for="PhotoJournalTitle" style="display: none;">
						<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORPhotoJournalTitle">"><b>Title (Journal, Conference Proceedings, Anthology)</b></span><br />
							<span class="note">Please do not abbreviate unless your citation is abbreviated</span>
						</span>
						<textarea id="PhotoJournalTitle" name="PhotoJournalTitle" rows="2" cols="40" class="f-name" ><#PARAM name="PhotoJournalTitle"></textarea><br />
				</label>		-->
						
					<label for="PhotoJournalVolume" style="display: none;">
						<span class="field">
							<span class="<#ERROR name="ERRORPhotoJournalVolume">"><b>Volume</b></span>
						</span>
						<input id="PhotoJournalVolume" name="PhotoJournalVolume" type="text" size="40" class="f-name"  value="<#PARAM name="PhotoJournalVolume">"><br />
				</label>
					
					<label for="PhotoJournalIssue" style="display: none;">
						<span class="field">
							<span class="<#ERROR name="ERRORPhotoJournalIssue">"><b>Issue Number or Designation</b></span>
						</span>
						<input id="PhotoJournalIssue" name="PhotoJournalIssue" type="text" size="40" class="f-name"  value="<#PARAM name="PhotoJournalIssue">"><br />
				</label>

					<label for="PhotoJournalMonth" style="display: none;">
						<span class="field">
							<span class="<#ERROR name="ERRORPhotoJournalMonth">"><b>Month</b></span>
						</span>
						<input id="PhotoJournalMonth" name="PhotoJournalMonth" type="text" size="40" class="f-name"  value="<#PARAM name="PhotoJournalMonth">"><br />
				</label>
					
					<label for="PhotoJournalYear" style="display: none;">
						<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORPhotoJournalYear">"><b>Year</b></span>
						</span>
						<input id="PhotoJournalYear" name="PhotoJournalYear" type="text" size="40" class="f-name"  value="<#PARAM name="PhotoJournalYear">"><br />
				</label>
				
					
					
					
                	<label for="ISSN">
					 	<span class="field">
                			<span class="<#ERROR name="ERRORISSN">"><b>ISSN/ISBN (International Standard Serial/Book Number)</b></span><br />
                		<span class="note" id="ISSNNote">If given will speed request processing</span>
						</span>
                		<input id="ISSN" name="ISSN" type="text" size="20" class="f-name"  value="<#PARAM name="ISSN">"><br />
               	</label>
					
                	<label for="CallNumber">					
						<span class="field">
							<span class="req">*</span>
							<span class="<#ERROR name="ERRORCallNumber">"><b>Call Number</b></span>
						</span>
                		<input id="CallNumber" name="CallNumber" type="text" size="20" class="f-name"  value="<#PARAM name="CallNumber">"><br />
               	</label>
					
                	<label for="ESPNumber">
						<span class="field">
                			<span class="<#ERROR name="ERRORESPNumber">"><b>OCLC or Docline UI Number</b></span>
						</span>
                		<input id="ESPNumber" name="ESPNumber" type="text" size="20" class="f-name"  value="<#PARAM name="ESPNumber">"><br />
               	</label>
					
                	<label for="NotWantedAfter">
						<span class="field">
                			<span class="req">*</span><span class="<#ERROR name="ERRORNotWantedAfter">"><b>Not Wanted After Date</b></span><br />
							<span class="note">(MM/DD/YYYY)</span>
						</span>
                		<input id="NotWantedAfter" name="NotWantedAfter" type="text" size="40" class="f-name"  value="<#PARAM name="NotWantedAfter">"><br />
               	</label>
					
                	<label for="AcceptNonEnglish">
					
						<span class="field">
																		<span class="req" id="AcceptNonEnglishReq">*</span>
                						<span class="<#ERROR name="ERRORAcceptNonEnglish">"><b>Will you accept the item in a language other than English?</b></span><br />
                			<span class="note">If yes, specify acceptable languages in the notes field.</span>
						</span>
                		<select id="AcceptNonEnglish" name="AcceptNonEnglish" size="1" class="f-name" >
                    		<option selected><#PARAM name="AcceptNonEnglish"></option>
                    		<option>No</option>
                    		<option>Yes</option>
                		</select>
						<br />
               	</label>
					
                	<label for="AcceptAlternateEdition">
						<span class="field">
                			<span class="req">*</span>			<span class="<#ERROR name="ERRORAcceptAlternateEdition">"><b>Will you accept an alternate edition of this item?</b></span>
						</span>
                		<select id="AcceptAlternateEdition" name="AcceptAlternateEdition" size="1" class="f-name" >
                    		<option selected><#PARAM name="AcceptAlternateEdition"></option>
                    		<option>No</option>
                    		<option>Yes</option>
                		</select>
                		<br />
               	</label>
								
									
                	<label for="facOrGrad" style="display: none;">
										<span class="field">
											<span class="req">*</span>
											<b><span id="facOrGradText" class="valid">Status</span></b>
											<br>
											<!--<span id="facOrGradNote" class="note">You must be a faculty member or graduate student to use this service.</span>-->
										</span>
					
										<select id="facOrGrad" name="facOrGrad">
											<option selected></option>
											<option>Faculty</option>
											<option>Graduate student</option>
											<option>Distance student</option>
											<option>Undergraduate</option>
											<option>Other</option>
										</select>
										<br>
									</label>
									
									<label for="itemInfo5" style="display: none;">
											<span class="field">
												<b><span id="itemInfo5Text" class="valid">Is this an Annex item?</span></b>
												<br>
												<!--<span id="facOrGradNote" class="note">You must be a faculty member or graduate student to use this service.</span>-->
											</span>
					
											<select id="itemInfo5" name="itemInfo5">
												<option selected></option>
												<option>Yes</option>
												<option>No</option>
											</select>
											<br>
									</label>
									
									<label for="ItemInfo3" style="display: none;">
									  
										<span class="field"><b>Campus mailbox</b><br>
											
											<span class="note">If you specify a campus mailbox, pickup library is not required. Expected delivery time is 2-3 days.</span>
										</span>
										<textarea id="ItemInfo3" type="text" name="ItemInfo3" rows="2"></textarea>
									<br>
									</label>
									
									<label for="ItemInfo4" style="display: none;">									  
										<span class="field">
											<span class="req" id="ItemInfo4Req">*</span>
											<b><span id="ItemInfo4Text" class="valid">Pickup location</span></b>
											<br>
												<span class="note" id="ItemInfo4Note" style="display: none;">Periodical/Serial will be placed on hold at the library where it is shelved.</span>
												<span style="display: none;" class="note" id="ItemInfo4DistanceEdNote">Delivery will be to your address in ILLiad which <em>does not</em> update automatically.  You can check or change this by clicking on <a href="<#ACTION action="10" form="81">">this User Information link</a> or by selecting User Information from the left-hand menu. </span>											
										</span>
					
										<select id="ItemInfo4" name="ItemInfo4">
											<option selected></option>
											<option>Gorgas</option>
											<option>Rodgers</option>
											<option>Bruno</option>
											<option>McLure</option>
										</select>
										
										
										<br>
										

									</label>
									<!--
										<label for="Address">
											<span class="field">
														<span class="<#ERROR name="ERRORAddress">"><b>Web Services Test -- ignore!</b></span>
											</span>
											<input id="Address" name="Address" type="text" size="40" class="f-name"  value="<#PARAM name="Address">"><br />
										</label>
										<label for="Site">
												<span class="field">
														<b><span class="<#ERROR name="ERRORSite">">Site (temporary Web Serv test)</span></b>
														<br>
												</span>
										   <select id="Site" name="Site" size="1" class="f-name" >
													<#OPTION name="custom" groupname="Site" defaultValue="Gorgas" />
											</select>
										</label>-->
									
									
									
									
                	<label for="Notes">
						<span class="field">
                			<span class="<#ERROR name="ERRORNotes">"><b>Notes</b></span><br />
                			<span class="note" >Put any information here that may help us find the item, as well as any other pertinent information.</span>
						</span>
                		<textarea id="Notes" name="Notes" rows="2" cols="40" class="f-name" ><#PARAM name="Notes"></textarea><br />
               	</label>
								
								
									</label>
									
					
                	<#INCLUDE filename="include_request_cited.html">                
                    <#INCLUDE filename="include_request_buttons.html">
                </fieldset>
            </form>

            <#INCLUDE filename="include_footer.html">
        </div>
    </div>
</div>


</body>
<script>
		console.log("VANILLA JS");
		var content = document.querySelector('#content'); 
		content.setAttribute('display', 'block');
</script>
<script>
$(document).ready(function(){

					var parameters = decodeURIComponent(document.location.search);
					
					//Set required fields
					
					
					
					if (parameters.indexOf('docdelivery=true') != -1){
						docDelivery = true;
						requiredFields = ['LoanTitle', 'LoanAuthor', 'NotWantedAfter', 'facOrGrad', 'AcceptAlternateEdition', 'CallNumber', 'ItemInfo4']; 
						//$('#AcceptNonEnglishReq').hide();
					}
					else{
						docDelivery = false;
						requiredFields = ['LoanTitle', 'LoanAuthor', 'NotWantedAfter', 'AcceptNonEnglish']; 
						
					}

					 if (docDelivery == true){
					 
							//Pickup library is ItemInfo4
							function pickupLibraryFadeIn(note){
							
									console.log("Pickup Library Fade In");
									
									$('#ItemInfo4').fadeIn(500);
									$('#ItemInfo4Note').fadeOut(500);
								
									var fieldIndex = requiredFields.indexOf('ItemInfo4');
									if ((fieldIndex < 0) && ($('#ItemInfo3').val() == '')){
										requiredFields.push('ItemInfo4');
										$('#ItemInfo4Req').show();
									}
							}
							
							//Pickup library is ItemInfo4
							function pickupLibraryFadeOut(note){
							
									console.log("Pickup Library Fade Out");
									
									$('#ItemInfo4').fadeOut(500);
									$('#ItemInfo4').val(function(index,value){
										return '';
									});
									
									$('#ItemInfo4Req').hide();
									
									if (note == true){
										$('#ItemInfo4Note').fadeIn(500);
									}
									else if (note == false){
										$('#ItemInfo4Note').fadeOut(500);
									}
												
									
									$('#ItemInfo4Text').removeClass('validationError').addClass('valid');
									var fieldIndex = requiredFields.indexOf('ItemInfo4');
									if (fieldIndex >= 0){
										requiredFields.splice(fieldIndex, 1);
									}
							}
							
							//Remove the delivery to address field when distance education is not chosen
							function removeDeliveryToAddress(){
								var pickupLocation = document.getElementById('ItemInfo4');
								var pickupLocations = pickupLocation.children;
								
								//Iterate to get index of delivery to address option (in case it changes)
								for (i = 0; i < pickupLocations.length; i++){
									if (pickupLocations[i].value == 'Delivery to address'){
										pickupLocation.remove(i);
									}
								}
								
								$('#ItemInfo4DistanceEdNote').hide();
							}
					 		
							$('#requestCited').css('display', 'none');
							
							$('input[name="ItemInfo1"]').attr('value', 'DocDeliveryPublic');
							
							//If both catalog and document delivery parameters are present, add doc delivery to form for automatic routing
							if ((parameters.indexOf('catalog=true') != -1)){
								$('input[name="ItemInfo1"]').attr('value', 'DocDelivery');
							}
							
							//Hide buttons that no longer work
							//$('input[name="ResetButton"]').css('display', 'none');
							$('input[value^="Cancel"]').css('display', 'none');
							
							
							$('#pageHeader').html("Document Delivery - Loan (UA Libraries Collection)");
							$('#pageHeader').after('<p id="pageIntroduction">Use this form to request document delivery for items you want to check out from University Libraries (this includes Annex requests). Faculty can choose to have items delivered to their campus mailbox via intracampus mail. You may be able to select a pickup library for an item depending on the type of the request.</p>');
							$('label[for="facOrGrad"]').css('display', 'block');
							$('label[for="ItemInfo4"]').css('display', 'block');
							$('label[for="itemInfo2"]').css('display', 'block');
							$('label[for="itemInfo5"]').css('display', 'block');
							$('label[for="ESPNumber"]').css('display', 'none');
							$('label[for="AcceptNonEnglish"]').css('display', 'none');
							$('#ISSNNote').css('display', 'none');
							//$('label[for="ISSN"]').css('display', 'none');
							//$('label[for="ItemInfo4"]').css('display', 'block');
						
							$('#facOrGrad').change(function(){
							
							  var annexValue = $('#itemInfo5').val();
								var serialLoanValue = $('#itemInfo2').val()
								
								if ($(this).val() == 'Faculty'){

										console.log("annex value is " + annexValue); 
										if (serialLoanValue != 'Yes'){
											$('label[for="ItemInfo3"]').fadeIn(500);
											pickupLibraryFadeIn();
										}
										
										removeDeliveryToAddress();																		
								}		
								else if ($(this).val() == 'Graduate student'){
										console.log("HITS GRAD STUDENT");
										$('label[for="ItemInfo3"]').fadeOut(500);
										
										$('#ItemInfo3').val(function(index,value){
											return '';
										});
										
										if (serialLoanValue != 'Yes'){
										  console.log("FADE IN");
											pickupLibraryFadeIn();
										}
										
										removeDeliveryToAddress();
								}
								else if ($(this).val() == 'Distance student'){
								
										$('#ItemInfo3').val(function(index,value){
											return '';
										});
										
										var pickup = document.getElementById('ItemInfo4');
										
										//Create new "Delivery to address" option
										var newOption = document.createElement('option');
										
										//Set attributes on new option
										newOption.value = 'Delivery to address';
										newOption.innerText = 'Delivery to address';
										newOption.id = "DeliveryToAddress";
										newOption.selected = true;
										pickup.add(newOption);
										
										$('#ItemInfo4DistanceEdNote').show();

								}
								else {
										$('label[for="ItemInfo3"]').fadeOut(500);
										
										$('#ItemInfo3').val(function(index,value){
											return '';
										});
										
										if (serialLoanValue != 'Yes'){									
											pickupLibraryFadeIn();
										}

										removeDeliveryToAddress();
								}
								
								if (annexValue == 'Yes'){
									//$('#ItemInfo4Note').text("For Annex requests, any user can specify a pickup library.");
								}
								else{
									 //$('#ItemInfo4Note').text("For document delivery, faculty or graduate students may choose to pick up their item at a library other than Gorgas.");
								}
								
								console.log("REQUIRED FIELDS");
								console.log(requiredFields);
							});
							
							//Campus mailbox
							$('#ItemInfo3').change(function(){
									console.log("CHANGE FIRES!");
								 if ($('#ItemInfo3').val() != ''){
										
									/*if ($('#pickupNote').length > 0){
											$('#pickupNote').css('display', 'block');
										}
										else {							
											$('#ItemInfo4Note').before('<span id="pickupNote" class="note" style="display: block"><strong>Since you specified delivery to your campus mailbox, pickup library cannot also be selected. </strong></span>');								
										}/*
										$('#ItemInfo4').val(function(index, value){												
													return '';
											});
										$('#ItemInfo4').prop("disabled", true);*/
										pickupLibraryFadeOut(false);
									}
									
									
								 else{
										pickupLibraryFadeIn();
								 }
								 
							 	console.log("REQUIRED FIELDS");
								console.log(requiredFields);
							});
							
							//Pickup library
							$('#ItemInfo4').change(function(){
								if ($(this).val() == 'Delivery to address'){
									$('#ItemInfo4DistanceEdNote').show();
								}
								else {
									$('#ItemInfo4DistanceEdNote').hide();
								}
							});
							
							//Annex request
							$('#itemInfo5').change(function(){
							  var facGradValue = $('#facOrGrad').val(); 
								var serialLoanValue = $('#itemInfo2').val()
								
								console.log(serialLoanValue);
								
								if ($(this).val() == 'Yes'){
									//$('#ItemInfo4Note').text("For Annex requests, any user can specify a pickup library.");
		
									//Show pickup library unless user is faculty and they filled in campus mailbox
									if ($('#facOrGrad').val() == 'Faculty'){

										if ($('#ItemInfo3').val() == ''){
											pickupLibraryFadeIn();
										}
										else {
											//$('#ItemInfo4Note').fadeOut(500);
										}
									}
									else{
										pickupLibraryFadeIn();
									}

									
									//if (serialLoanValue == 'Yes'){
										
										//$('#pickupNote').css('display', 'none');
										
									//}
									
								}
								else if (($(this).val() == 'No') || ($(this).val() == '')){
								  //$('#ItemInfo4Note').text("For document delivery, faculty or graduate students may choose to pick up their item at a library other than Gorgas.");
								
									console.log(facGradValue);
									/*
									if ((facGradValue != 'Faculty') && (facGradValue != 'Graduate student')){
										$('label[for="ItemInfo4"').fadeOut(500);
									}
									else{
										$('label[for="ItemInfo4"').fadeOut(500);
									}*/
									
									if (serialLoanValue == 'Yes'){
										pickupLibraryFadeOut(true);
										$('label[for="ItemInfo3"]').fadeOut(500);
										
										$('#ItemInfo3').val(function(index,value){
											return '';
										});
										
									}
									else {
										//Show pickup library unless user is faculty and they filled in campus mailbox
										if ($('#facOrGrad').val() == 'Faculty'){
											$('label[for="ItemInfo3"]').fadeIn(500);
											if ($('#ItemInfo3').val() == ''){
												pickupLibraryFadeIn();
											}
										}
										else{
											pickupLibraryFadeIn();
										}									
									}						

									//if (serialLoanValue == 'Yes'){
										//$('#ItemInfo4Note').text("Periodical/Serial will be placed on hold at the library where it is shelved");	
										//$('#pickupNote').css('display', 'none');
									//}
								}
									
								console.log("REQUIRED FIELDS");
								console.log(requiredFields);
							});
							
							//Serial loan request
							$('#itemInfo2').change(function(){
							
								var annexValue = $('#itemInfo5').val();
								
							  if ($(this).val() == 'Yes'){
												  
								 	//$('label[for="LoanTitle"]').fadeOut(500);
									$('label[for="LoanAuthor"]').fadeOut(500);
									$('label[for="LoanPublisher"]').fadeOut(500);
									$('label[for="LoanPlace"]').fadeOut(500);
									$('label[for="LoanDate"]').fadeOut(500);
									$('label[for="LoanEdition"]').fadeOut(500);
									$('label[for="LoanPublisher"]').fadeOut(500);
								
									$('label[for="AcceptAlternateEdition"]').fadeOut(500);
									
									//$('label[for="PhotoJournalTitle"]').fadeIn(500);
									$('label[for="PhotoJournalVolume"]').fadeIn(500);
									$('label[for="PhotoJournalIssue"]').fadeIn(500);
									$('label[for="PhotoJournalMonth"]').fadeIn(500);
									$('label[for="PhotoJournalYear"]').fadeIn(500);
								
								  //Campus mailbox should always be hidden for serial loan requests
									$('label[for="ItemInfo3"]').fadeOut(500);
									
									$('#ItemInfo3').val(function(index,value){
											return '';
										});
								
								  //Pickup library should be hidden for non-Annex requests
									if (annexValue != 'Yes'){
										console.log("TEST YES");
										pickupLibraryFadeOut(true);					
									}
									else{
										//else just for debugging
										console.log("TEST NO");
									}
									
	
									
									var fieldsToBeRemoved = ['LoanAuthor', 'ItemInfo4', 'AcceptAlternateEdition'];
									for (j = 0; j < fieldsToBeRemoved.length; j++){
								
									  var currentField = fieldsToBeRemoved[j];
										var fieldIndex = requiredFields.indexOf(currentField);
										if (fieldIndex >= 0){
											requiredFields.splice(fieldIndex, 1);
										}
									}															
									
									var fieldsToBeAdded = ['PhotoJournalYear'];
									for (j = 0; j < fieldsToBeAdded.length; j++){
										var currentField = fieldsToBeAdded[j];
										var fieldIndex = requiredFields.indexOf(currentField);
										if (fieldIndex == -1){
											requiredFields.push(currentField);
										}
									}
																	
									
									console.log("REQUIRED FIELDS");
									console.log(requiredFields);
									
									
								}
								else if ($(this).val() == 'No'){
									//$('label[for="LoanTitle"]').fadeIn(500);
									$('label[for="LoanPublisher"]').fadeIn(500);
									$('label[for="LoanPlace"]').fadeIn(500);
									$('label[for="LoanDate"]').fadeIn(500);
									$('label[for="LoanEdition"]').fadeIn(500);
									$('label[for="LoanAuthor"]').fadeIn(500);
									$('label[for="LoanPublisher"]').fadeIn(500);
									$('label[for="AcceptAlternateEdition"]').fadeIn(500);
								
									//$('label[for="PhotoJournalTitle"]').fadeOut(500);
									$('label[for="PhotoJournalVolume"]').fadeOut(500);
									$('label[for="PhotoJournalIssue"]').fadeOut(500);
									$('label[for="PhotoJournalMonth"]').fadeOut(500);
									$('label[for="PhotoJournalYear"]').fadeOut(500);
									
									

									//Show pickup library unless user is faculty and they filled in campus mailbox
									if ($('#facOrGrad').val() == 'Faculty'){
										$('label[for="ItemInfo3"]').fadeIn(500);
										if ($('#ItemInfo3').val() == ''){
											pickupLibraryFadeIn();
										}
									}
									else{
										pickupLibraryFadeIn();
									}

								
									
									//$('#ItemInfo4Note').fadeOut(500)
									
									var fieldsToBeRemoved = ['PhotoJournalYear'];
									for (j = 0; j < fieldsToBeRemoved.length; j++){
								
									  var currentField = fieldsToBeRemoved[j];
										var fieldIndex = requiredFields.indexOf(currentField);
										if (fieldIndex >= 0){
											requiredFields.splice(fieldIndex, 1);
										}
									}
									
									var fieldsToBeAdded = ['LoanAuthor', 'AcceptAlternateEdition'];								
									for (j = 0; j < fieldsToBeAdded.length; j++){
										var currentField = fieldsToBeAdded[j];
										var fieldIndex = requiredFields.indexOf(currentField);
										if (fieldIndex == -1){
												requiredFields.push(currentField);
										}
									}
									
									
									console.log("REQUIRED FIELDS");
									console.log(requiredFields);
										
								}
																						
							
			
							});
	
					 }

					 else {
							$('label[for="CallNumber"] span.req').css('display', 'none');
					 }
					 
					 	if (parameters.indexOf('serialloanrequest=true') != -1){
								$('#itemInfo2').val(function(index, value){
											return "Yes"
								});
								$('#itemInfo2').change();
					  }
					 

							$('#LoanRequestForm').submit(function(event){
							
									if (docDelivery == true){
										$('#Notes').val(function(index, value){
										
										 //Cram fac/grad value into Notes field when form is submitted
											var notesValue = $('#Notes').val();
											var facOrGradValue = $('#facOrGrad').val();

											if (facOrGradValue == 'Faculty'){
												var facOrGradIndex = notesValue.indexOf('Faculty request / ');
												
												if (facOrGradIndex == -1){		
													
													notesValue = 'Faculty request / ' + notesValue; 
								
												}
											}
											else {
												if (facOrGradValue == 'Graduate student request'){

													facOrGradIndex = notesValue.indexOf('Graduate student request / ');
													if (facOrGradIndex == -1){		
														notesValue = 'Faculty request / ' + notesValue; 
													}
												}
											}
															
											return notesValue;
									});
								}
								
								 var missingFields = []; 
								 
								 //Check for validation errors
								 for (i = 0; i < requiredFields.length; i++){
										currentField = requiredFields[i];
										currentContent = $('#' + currentField).val();
										
										//console.log("CURRENT FIELD IS");
										//console.log(currentField);
										
										//console.log("CURRENT CONTENT IS");
										//console.log(currentContent);
										
										if (currentContent == ''){											
											console.log("FORM UNFILLED!");
											missingFields.push(currentField);
											$('label[for="' + currentField + '"] span.valid').addClass('validationError').removeClass('valid');
										}		
										else {
											$('label[for="' + currentField + '"] span.validationError').addClass('valid').removeClass('validationError');
										}
								 }
								 //testCounter = 0;
								 
								 //Empty fields that are hidden
								 $('#LoanRequestForm > fieldset > label').each(function(index){
									var displayAttr = $(this).attr('style');
									
									if (displayAttr != undefined){
									  
										if (displayAttr.indexOf('display: none') != -1 ){
										  //testCounter++;
										  console.log("DISPLAY ATTRIBUTE PRESENT");
										  $(this).find('input').val(function(index, value){
											  console.log("SETTING INPUT");
												return '';
											});
											$(this).find('select').val(function(index, value){
											  console.log("SETTING SELECT");
												return '';
											});
											$(this).find('textarea').val(function(index, value){
											  console.log("SETTING TEXTAREA");
												return '';
											});
											
										}
									}
								});
								
								//console.log("TEST COUNTER IS ");
								//console.log(testCounter);
								

								if (missingFields.length > 0){
									
									 topErrorMessage = '<p style="color: red;">Required fields are missing.</p>';
									 
									 console.log("MISSING FIELDS ARRAY");
									 console.log(missingFields);
									
									 topErrorMessage += "</div>";
									 
									 console.log("TOP ERROR MESSAGE IS");
									 console.log(topErrorMessage);
									 if ($('#TopErrorMessage').length == 0){
										 topErrorMessage = '<div id="TopErrorMessage">' + topErrorMessage + '</div>';
										 $('#pageHeader').after(topErrorMessage);
									 }
									 else {
									  $('#TopErrorMessage').html('');
										$('#TopErrorMessage').html(topErrorMessage);
									 }
									 
									 console.log("RETURNING FALSE");
									 return false;						 
								 }	

								
						});
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					 
					
					 $('#content').css('display', 'block');

});
</script>
<script>
console.log("VANILLA JS");
var content = document.querySelector('#content'); 
content.setAttribute('display', 'block');
</script>
</html>
